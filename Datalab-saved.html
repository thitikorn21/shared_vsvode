<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Datalab - Free-Form Canvas</title>
    <!-- Google Fonts - Outfit for display, Inter for body, Fira Code for mono -->
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;600;700&family=Inter:wght@300;400;500;600;700&family=Fira+Code:wght@400;500;600&display=swap" rel="stylesheet">
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Tailwind Configuration & Custom Styles -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'primary-blue': '#2C3E50', // Deep, cool blue for primary elements
                        'secondary-gray': '#E0E6EE', // Muted professional gray for backgrounds/hover
                        'canvas-bg': '#F8F9FB', // Very light gray/off-white for canvas background
                        'accent-teal': '#2ECC71', // Vibrant deep teal accent
                        'accent-teal-dark': '#27AE60', // Darker teal for hover states
                        'text-dark': '#34495E', // Darker text for main content
                        'text-light': '#ECF0F1', // Light text for contrast on dark backgrounds
                        'element-border': '#CBD5E0', // Light border for canvas elements
                        'element-bg': '#FFFFFF', // White background for canvas elements
                    },
                    fontFamily: {
                        display: ['Outfit', 'sans-serif'],
                        body: ['Inter', 'sans-serif'],
                        mono: ['Fira Code', 'monospace'],
                    },
                    boxShadow: {
                        'element': '0 4px 10px rgba(0, 0, 0, 0.08), 0 1px 3px rgba(0, 0, 0, 0.05)',
                        'neumorphic-inner': 'inset 5px 5px 10px #d9d9d9, inset -5px -5px 10px #ffffff',
                        'neumorphic-outer': '5px 5px 10px #d9d9d9, -5px -5px 10px #ffffff',
                    }
                }
            }
        }
    </script>
    <style>
        /* Custom scrollbar for a polished look */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: theme('colors.secondary-gray');
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: theme('colors.primary-blue');
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: theme('colors.accent-teal');
        }

        /* Base styles for the canvas to allow drag/drop simulation */
        #canvas-area {
            position: relative;
            /* Using a subtle background-image for a grid effect */
            background-image:
                linear-gradient(to right, theme('colors.secondary-gray') 1px, transparent 1px),
                linear-gradient(to bottom, theme('colors.secondary-gray') 1px, transparent 1px);
            background-size: 20px 20px; /* Grid spacing */
            background-position: -1px -1px; /* Align grid lines */
        }

        /* Canvas Element Styling */
        .canvas-element {
            position: absolute;
            background-color: theme('colors.element-bg');
            border: 1px solid theme('colors.element-border');
            border-radius: 12px;
            box-shadow: theme('boxShadow.element');
            transition: transform 0.1s ease-out, box-shadow 0.1s ease-out, border-color 0.1s ease-out;
            cursor: grab;
            resize: both; /* Allows basic resizing simulation */
            overflow: auto; /* Ensures content within is scrollable if element is small */
            min-width: 150px;
            min-height: 80px;
            padding: 1rem;
        }
        .canvas-element.selected {
            border-color: theme('colors.accent-teal');
            box-shadow: 0 0 0 3px theme('colors.accent-teal'), theme('boxShadow.element'); /* Glow effect on selection */
            cursor: grabbing;
        }
        .canvas-element:hover {
             box-shadow: 0 6px 15px rgba(0, 0, 0, 0.12), 0 2px 5px rgba(0, 0, 0, 0.08); /* Slightly more pronounced shadow on hover */
        }

        /* Icon styling using SVG data URIs for self-containment */
        .icon {
            display: inline-block;
            width: 24px;
            height: 24px;
            background-color: currentColor; /* Inherit color from parent */
            mask-size: cover;
            -webkit-mask-size: cover;
        }
        .icon-save { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M17 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V7l-4-4zm-5 16c-1.66 0-3-1.34-3-3s1.34-3 3-3 3 1.34 3 3-1.34 3-3 3zm3-10H5V5h10v4z"/></svg>'); }
        .icon-share { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.52.47 1.2.77 1.96.77 1.66 0 3-1.34 3-3s-1.34-3-3-3-3 1.34-3 3c0 .24.04.47.09.7L8.04 9.81c-.52-.47-1.2-.77-1.96-.77-1.66 0-3 1.34-3 3s1.34 3 3 3c.76 0 1.44-.3 1.96-.77l7.05 4.11c-.05.23-.09.46-.09.7 0 1.66 1.34 3 3 3s3-1.34 3-3-1.34-3-3-3z"/></svg>'); }
        .icon-user { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 3c1.66 0 3 1.34 3 3s-1.34 3-3 3-3-1.34-3-3 1.34-3 3-3zm0 14.2c-2.5 0-4.71-1.29-6-3.22.03-1.99 4-3.88 6-3.88s5.97 1.89 6 3.88c-1.29 1.93-3.5 3.22-6 3.22z"/></svg>'); }
        .icon-text-block { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M4 15h16v-2H4v2zm0 4h16v-2H4v2zm0-8h16V9H4v2zm0-6v2h16V5H4z"/></svg>'); }
        .icon-image { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>'); }
        .icon-chart { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9 17H7V10H9V17zm4 0h-2V7h2V17zm4 0h-2V13h2V17zm3-15H4c-1.1 0-2 .9-2 2v16c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 18H4V4h16v16z"/></svg>'); }
        .icon-code { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M9.4 16.6L4.8 12l4.6-4.6L8 6l-6 6 6 6 1.4-1.4zm5.2 0l4.6-4.6-4.6-4.6L16 6l6 6-6 6-1.4-1.4z"/></svg>'); }
        .icon-link { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>'); }
        .icon-shape { mask-image: url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 14.5c-2.49 0-4.5-2.01-4.5-4.5S9.51 7.5 12 7.5s4.5 2.01 4.5 4.5-2.01 4.5-4.5 4.5z"/></svg>'); }

        /* Responsive adjustments for sidebar */
        @media (max-width: 768px) {
            #sidebar {
                position: fixed;
                top: 64px; /* Below header */
                left: 0;
                width: 100%;
                height: auto;
                max-height: calc(100vh - 64px); /* Max height to fit viewport */
                overflow-y: auto;
                transform: translateY(-100%); /* Hidden by default on mobile */
                transition: transform 0.3s ease-in-out;
                z-index: 40; /* Above canvas */
                border-bottom: 1px solid theme('colors.element-border');
            }
            #sidebar.open {
                transform: translateY(0); /* Show sidebar */
            }
            #sidebar-toggle-button {
                display: flex; /* Show toggle button on mobile */
            }
            /* Adjust main content when sidebar is open on mobile */
            #main-content-wrapper.sidebar-open {
                 margin-top: calc(var(--sidebar-height-on-mobile, 0px)); /* Placeholder, actual height handled by JS */
            }
        }
    </style>
</head>
<body class="bg-canvas-bg font-body text-text-dark min-h-screen overflow-hidden">

    <!-- Header -->
    <header class="flex items-center justify-between p-4 bg-primary-blue text-text-light shadow-lg z-50 relative">
        <div class="flex items-center">
            <h1 class="text-3xl font-display font-bold mr-4">Datalab</h1>
            <span class="text-accent-teal text-sm font-body tracking-wider">Canvas Workspace</span>
        </div>
        <div class="flex items-center space-x-4">
            <button class="flex items-center px-4 py-2 rounded-lg bg-accent-teal hover:bg-accent-teal-dark transition-colors duration-200 text-text-light font-body text-sm shadow-md">
                <span class="icon icon-save mr-2 text-text-light"></span>
                Save
            </button>
            <a href="https://example.com/share" target="_blank" class="flex items-center px-4 py-2 rounded-lg bg-primary-blue border border-text-light hover:border-accent-teal hover:text-accent-teal transition-all duration-200 text-text-light font-body text-sm shadow-md">
                <span class="icon icon-share mr-2 text-text-light"></span>
                Share
            </a>
            <div class="relative group">
                <button class="flex items-center justify-center w-10 h-10 rounded-full bg-secondary-gray text-primary-blue hover:bg-text-light hover:text-accent-teal transition-colors duration-200 focus:outline-none shadow-md">
                    <span class="icon icon-user text-primary-blue group-hover:text-accent-teal"></span>
                </button>
                <!-- User Profile Dropdown -->
                <div class="absolute right-0 mt-2 w-48 bg-element-bg border border-element-border rounded-md shadow-lg py-1 z-10 opacity-0 group-hover:opacity-100 group-hover:translate-y-0 translate-y-2 transition-all duration-200 ease-out pointer-events-none group-hover:pointer-events-auto">
                    <a href="https://example.com/profile" target="_blank" class="block px-4 py-2 text-sm text-text-dark hover:bg-secondary-gray transition-colors duration-150">Profile Settings</a>
                    <a href="https://example.com/logout" target="_blank" class="block px-4 py-2 text-sm text-text-dark hover:bg-secondary-gray transition-colors duration-150">Sign Out</a>
                </div>
            </div>

            <!-- Sidebar Toggle Button for Mobile -->
            <button id="sidebar-toggle-button" class="md:hidden p-2 rounded-lg text-text-light hover:bg-primary-blue/70 transition-colors duration-200">
                <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
                </svg>
            </button>
        </div>
    </header>

    <!-- Main Application Area -->
    <div class="flex flex-col md:flex-row h-[calc(100vh-64px)] overflow-hidden">

        <!-- Sidebar / Toolbox -->
        <aside id="sidebar" class="w-full md:w-64 bg-element-bg border-r border-element-border p-4 shadow-xl z-40 flex-shrink-0
                                   md:relative md:transform-none md:translate-y-0
                                   transition-transform duration-300 ease-in-out md:block">
            <h2 class="text-lg font-display font-semibold mb-4 text-primary-blue">Toolbox</h2>
            <div class="grid grid-cols-2 md:grid-cols-1 gap-3">
                <div class="toolbox-item p-3 flex flex-col items-center rounded-lg cursor-pointer transition-all duration-200
                            hover:bg-secondary-gray hover:shadow-sm group border border-transparent hover:border-accent-teal">
                    <span class="icon icon-text-block text-primary-blue group-hover:text-accent-teal mb-2"></span>
                    <span class="text-sm font-body text-text-dark group-hover:text-primary-blue">Text Block</span>
                </div>
                <div class="toolbox-item p-3 flex flex-col items-center rounded-lg cursor-pointer transition-all duration-200
                            hover:bg-secondary-gray hover:shadow-sm group border border-transparent hover:border-accent-teal">
                    <span class="icon icon-image text-primary-blue group-hover:text-accent-teal mb-2"></span>
                    <span class="text-sm font-body text-text-dark group-hover:text-primary-blue">Image</span>
                </div>
                <div class="toolbox-item p-3 flex flex-col items-center rounded-lg cursor-pointer transition-all duration-200
                            hover:bg-secondary-gray hover:shadow-sm group border border-transparent hover:border-accent-teal">
                    <span class="icon icon-chart text-primary-blue group-hover:text-accent-teal mb-2"></span>
                    <span class="text-sm font-body text-text-dark group-hover:text-primary-blue">Data Chart</span>
                </div>
                <div class="toolbox-item p-3 flex flex-col items-center rounded-lg cursor-pointer transition-all duration-200
                            hover:bg-secondary-gray hover:shadow-sm group border border-transparent hover:border-accent-teal">
                    <span class="icon icon-code text-primary-blue group-hover:text-accent-teal mb-2"></span>
                    <span class="text-sm font-body text-text-dark group-hover:text-primary-blue">Code Snippet</span>
                </div>
                <div class="toolbox-item p-3 flex flex-col items-center rounded-lg cursor-pointer transition-all duration-200
                            hover:bg-secondary-gray hover:shadow-sm group border border-transparent hover:border-accent-teal">
                    <span class="icon icon-link text-primary-blue group-hover:text-accent-teal mb-2"></span>
                    <span class="text-sm font-body text-text-dark group-hover:text-primary-blue">External Link</span>
                </div>
                 <div class="toolbox-item p-3 flex flex-col items-center rounded-lg cursor-pointer transition-all duration-200
                            hover:bg-secondary-gray hover:shadow-sm group border border-transparent hover:border-accent-teal">
                    <span class="icon icon-shape text-primary-blue group-hover:text-accent-teal mb-2"></span>
                    <span class="text-sm font-body text-text-dark group-hover:text-primary-blue">Shape</span>
                </div>
            </div>
            <p class="mt-6 text-xs text-text-dark/70 text-center">Drag elements onto the canvas or right-click to add.</p>
        </aside>

        <!-- Main Content Area (Canvas) -->
        <main id="main-content-wrapper" class="flex-1 overflow-auto bg-canvas-bg relative">
            <div id="canvas-area" class="w-[3000px] h-[2000px] p-8"> <!-- Large canvas area for infinite scroll simulation -->

                <!-- Example Canvas Elements -->
                <div class="canvas-element selected" style="top: 50px; left: 80px; width: 350px; height: 180px;">
                    <h3 class="font-display font-semibold text-lg text-primary-blue mb-2">Project Overview: Sales Data Analysis</h3>
                    <p class="text-sm text-text-dark font-body">
                        This Datalab canvas consolidates key insights for our Q3 sales performance.
                        We'll explore regional trends, product category impact, and customer segments.
                    </p>
                </div>

                <div class="canvas-element" style="top: 250px; left: 450px; width: 400px; height: 250px;">
                    <h3 class="font-display font-semibold text-lg text-primary-blue mb-2">Regional Sales (Mock Chart)</h3>
                    <div class="h-36 bg-secondary-gray rounded-lg flex items-end p-3 space-x-3 shadow-inner">
                        <div class="w-1/4 bg-primary-blue h-3/4 rounded-t-lg transition-all duration-300 hover:scale-y-105"></div>
                        <div class="w-1/4 bg-primary-blue h-1/2 rounded-t-lg transition-all duration-300 hover:scale-y-105"></div>
                        <div class="w-1/4 bg-accent-teal h-full rounded-t-lg transition-all duration-300 hover:scale-y-105"></div>
                        <div class="w-1/4 bg-primary-blue h-2/3 rounded-t-lg transition-all duration-300 hover:scale-y-105"></div>
                    </div>
                    <p class="text-xs text-text-dark/70 mt-2 text-center">Simulated Q3 Sales: West, Central, East, South.</p>
                </div>

                <div class="canvas-element" style="top: 100px; left: 500px; width: 300px; height: 120px;">
                    <h3 class="font-display font-semibold text-lg text-primary-blue mb-2">Key Hypothesis</h3>
                    <p class="text-sm text-text-dark font-body italic">
                        "The new marketing campaign directly correlated with the 15% sales increase in the East region."
                    </p>
                </div>

                <div class="canvas-element" style="top: 300px; left: 100px; width: 380px; height: 200px;">
                    <h3 class="font-display font-semibold text-lg text-primary-blue mb-2">SQL Query for Q3 Sales</h3>
                    <pre class="bg-primary-blue/90 text-text-light p-3 rounded-md overflow-x-auto text-xs font-mono shadow-inner"><code>
SELECT
  region,
  SUM(sales) as total_sales
FROM
  sales_data_q3
WHERE
  date BETWEEN '2023-07-01' AND '2023-09-30'
GROUP BY
  region
ORDER BY
  total_sales DESC;
                    </code></pre>
                </div>

                <div class="canvas-element" style="top: 550px; left: 80px; width: 300px; height: 150px;">
                    <h3 class="font-display font-semibold text-lg text-primary-blue mb-2">External Dashboard Link</h3>
                    <a href="https://www.tableau.com" target="_blank" class="text-accent-teal hover:underline text-sm font-body">
                        View Tableau Sales Dashboard â†’
                    </a>
                    <p class="text-xs text-text-dark/70 mt-2">Q3 Sales Performance Dashboard (link opens in new tab)</p>
                </div>

                <div class="canvas-element" style="top: 580px; left: 420px; width: 350px; height: 180px;">
                    <h3 class="font-display font-semibold text-lg text-primary-blue mb-2">Data Table Preview</h3>
                    <table class="w-full text-sm font-body text-text-dark border-collapse">
                        <thead>
                            <tr class="bg-secondary-gray/50">
                                <th class="p-2 text-left border-b border-element-border">Region</th>
                                <th class="p-2 text-left border-b border-element-border">Sales</th>
                                <th class="p-2 text-left border-b border-element-border">Growth</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td class="p-2 border-b border-element-border">East</td>
                                <td class="p-2 border-b border-element-border">$1.2M</td>
                                <td class="p-2 border-b border-element-border text-accent-teal">+15%</td>
                            </tr>
                            <tr>
                                <td class="p-2">West</td>
                                <td class="p-2">$0.9M</td>
                                <td class="p-2 text-primary-blue">-2%</td>
                            </tr>
                        </tbody>
                    </table>
                    <p class="text-xs text-text-dark/70 mt-2 text-center">Snapshot of Q3 Sales by Region.</p>
                </div>

            </div>
        </main>
    </div>

    <!-- JavaScript for interactivity -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const sidebarToggleButton = document.getElementById('sidebar-toggle-button');
            const sidebar = document.getElementById('sidebar');
            const canvasArea = document.getElementById('canvas-area');
            const mainContentWrapper = document.getElementById('main-content-wrapper');

            // Toggle sidebar on mobile
            if (sidebarToggleButton) {
                sidebarToggleButton.addEventListener('click', (e) => {
                    e.stopPropagation(); // Prevent click from propagating to document and immediately closing sidebar
                    sidebar.classList.toggle('open');
                    mainContentWrapper.classList.toggle('sidebar-open');

                    if (sidebar.classList.contains('open')) {
                        // Set custom property for dynamic margin-top on mobile
                        document.documentElement.style.setProperty('--sidebar-height-on-mobile', `${sidebar.offsetHeight}px`);
                        mainContentWrapper.style.marginTop = `${sidebar.offsetHeight}px`;

                        // Add a click listener to close sidebar when clicking outside
                        const closeSidebar = (event) => {
                            // Only close if click is outside sidebar and not on the toggle button itself
                            if (!sidebar.contains(event.target) && !sidebarToggleButton.contains(event.target)) {
                                sidebar.classList.remove('open');
                                mainContentWrapper.classList.remove('sidebar-open');
                                mainContentWrapper.style.marginTop = '0px'; // Reset margin
                                document.removeEventListener('click', closeSidebar);
                            }
                        };
                        // Use setTimeout to ensure the current click event (which opened the sidebar) finishes propagation
                        setTimeout(() => document.addEventListener('click', closeSidebar), 0);
                    } else {
                        mainContentWrapper.style.marginTop = '0px'; // Reset margin
                    }
                });
            }

            // Basic Drag & Drop for Canvas Elements
            let activeElement = null;
            let initialX, initialY, xOffset, yOffset;

            canvasArea.addEventListener('mousedown', (e) => {
                const targetElement = e.target.closest('.canvas-element');
                // Check if the click is directly on the element or on its resize handle (default behavior)
                // To prevent dragging when trying to resize, we check if it's NOT a resize handle area
                const isResizeHandle = e.offsetX > targetElement?.offsetWidth - 10 || e.offsetY > targetElement?.offsetHeight - 10;

                if (targetElement && !isResizeHandle) {
                    // Deselect any previously selected elements
                    document.querySelectorAll('.canvas-element.selected').forEach(el => {
                        el.classList.remove('selected');
                        el.style.cursor = 'grab';
                    });

                    activeElement = targetElement;
                    activeElement.classList.add('selected');

                    initialX = e.clientX;
                    initialY = e.clientY;
                    // Calculate offset from element's top-left corner
                    xOffset = e.clientX - activeElement.getBoundingClientRect().left;
                    yOffset = e.clientY - activeElement.getBoundingClientRect().top;

                    activeElement.style.cursor = 'grabbing';
                    e.preventDefault(); // Prevent default browser drag behavior (e.g., image dragging)
                } else if (!targetElement) {
                    // Deselect any selected element if clicking on canvas background
                    document.querySelectorAll('.canvas-element.selected').forEach(el => {
                        el.classList.remove('selected');
                        el.style.cursor = 'grab';
                    });
                }
            });

            canvasArea.addEventListener('mousemove', (e) => {
                if (activeElement) {
                    // Calculate new position based on mouse movement and initial offset
                    const newLeft = e.clientX - xOffset;
                    const newTop = e.clientY - yOffset;

                    // Adjust for canvas scroll position relative to viewport
                    activeElement.style.left = `${newLeft - canvasArea.getBoundingClientRect().left + canvasArea.scrollLeft}px`;
                    activeElement.style.top = `${newTop - canvasArea.getBoundingClientRect().top + canvasArea.scrollTop}px`;
                    e.preventDefault();
                }
            });

            canvasArea.addEventListener('mouseup', () => {
                if (activeElement) {
                    activeElement.style.cursor = 'grab'; // Change cursor back
                    // Keep 'selected' class on mouseup, only remove on click elsewhere or new drag
                    activeElement = null;
                }
            });

            // Prevent text selection during drag on some browsers
            canvasArea.addEventListener('selectstart', (e) => {
                if (activeElement) e.preventDefault();
            });

            // Simple right-click context menu simulation
            canvasArea.addEventListener('contextmenu', (e) => {
                e.preventDefault(); // Prevent default browser context menu

                // Remove any existing context menus
                document.querySelectorAll('.context-menu').forEach(menu => menu.remove());

                const menu = document.createElement('div');
                menu.className = 'context-menu absolute bg-element-bg border border-element-border rounded-md shadow-lg py-1 z-50 text-sm font-body';
                menu.style.left = `${e.clientX}px`;
                menu.style.top = `${e.clientY}px`;

                let menuItems = [];
                const clickedElement = e.target.closest('.canvas-element');
                if (clickedElement) {
                    // Select the element if a context menu is opened on it
                    document.querySelectorAll('.canvas-element.selected').forEach(el => el.classList.remove('selected'));
                    clickedElement.classList.add('selected');

                    menuItems = [
                        'Edit Element', 'Duplicate', 'Delete', 'Bring to Front', 'Send to Back', 'Add Link'
                    ];
                } else {
                    menuItems = [
                        'Add New Element', 'Paste', 'Toggle Grid', 'Zoom In', 'Zoom Out', 'Fit to View'
                    ];
                }

                menuItems.forEach(itemText => {
                    const item = document.createElement('a');
                    item.href = '#';
                    item.className = 'block px-4 py-2 text-text-dark hover:bg-secondary-gray transition-colors duration-150 whitespace-nowrap';
                    item.textContent = itemText;
                    item.addEventListener('click', (ev) => {
                        ev.preventDefault();
                        console.log(`Context Action: ${itemText} on ${clickedElement ? 'Element' : 'Canvas'}`);
                        menu.remove();
                    });
                    menu.appendChild(item);
                });

                document.body.appendChild(menu);

                // Close menu when clicking outside or another right click
                const closeMenu = (event) => {
                    if (!menu.contains(event.target) && event.button !== 2) { // Exclude right-click that opened it
                        menu.remove();
                        document.removeEventListener('click', closeMenu);
                        document.removeEventListener('contextmenu', closeMenu);
                    }
                };
                // Small delay to prevent immediate close if the same right-click triggered it
                setTimeout(() => {
                    document.addEventListener('click', closeMenu);
                    document.addEventListener('contextmenu', closeMenu);
                }, 10);
            });
        });
    </script>
</body>
</html>
